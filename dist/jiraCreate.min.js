!function(e){e.module("jiraCreate",[]).provider("JIRA",function(){var r={};this.$get=["$http","$filter","$q",function(t,i,s){return r.encloseInObject=function(e){return{value:e}},r.generateField=function(e,t){if(e.value)return e.value;if(t[e.inquiryField]){var i=e.map?e.map[t[e.inquiryField]]:t[e.inquiryField];return i=e.filter?e.filter(i):i,e.encloseInObject?r.encloseInObject(i):i}},r.createIssue=function(e,r,t){return{fields:{summary:e,issuetype:{name:r},project:{key:t}}}},r.issuePath=r.issuePath||"/rest/api/2/issue",r.defaultProxy=r.defaultProxy||"/jira-form-proxy.php?url=",r.postItem=function(e,i,s){return t.post((s||r.defaultProxy)+(i||r.defaultServer)+r.issuePath,e)},r.submitRequest=function(t,n){n.onSubmit&&n.onSubmit();var u=e.isString(n.summary)?n.summary:n.summary(t),o=e.isString(n.issueType)?n.issueType:n.issueType(t),a=e.isString(n.projectKey)?n.projectKey:n.projectKey(t),c=r.createIssue(u,o,a);return e.forEach(n.commonFields,function(e,i){c.fields[i]=r.generateField(e,t)}),e.isDefined(n.issueTypes)&&e.forEach(n.issueTypes[c.fields.issuetype.name],function(e,i){c.fields[i]=r.generateField(e,t)}),c.fields[n.inquiryDumpField]=i("json")(t),r.postItem(i("json")(c),n.server,n.proxyUrl).then(r.checkSuccessValidity).catch(function(e){if(!n.retryOnError)return s.reject(e);var t={fields:{summary:"Error from form",issuetype:{name:o},project:{key:a}}};return t[n.inquiryDumpField]=c.fields[n.inquiryDumpField]+"\n\n"+i("json")(err),r.postItem(i("json")(t),n.server,n.proxyUrl)})},r.checkSuccessValidity=function(r){var t=r.data;if(!(e.isObject(t)&&e.isString(t.self)&&e.isString(t.key)&&e.isString(t.id)))throw"Got success, but response does not match expectation.";return r},r}],this.setJIRAIssueCreationPath=function(e){r.issuePath=e},this.setServer=function(e){r.defaultServer=e},this.setProxy=function(e){r.defaultProxy=e}})}(window.angular);