!function(e){e.module("jiraCreate",[]).provider("JIRA",function(){var t={};this.$get=["$http","$filter","$q",function(i,s,r){return t.encloseInObject=function(e){return{value:e}},t.generateField=function(e,i){if(e.value)return e.value;if(i[e.inquiryField]){var s=e.map?e.map[i[e.inquiryField]]:i[e.inquiryField];return s=e.filter?e.filter(s):s,e.encloseInObject?t.encloseInObject(s):s}},t.createIssue=function(e,t,i){return{fields:{summary:e,issuetype:{name:t},project:{key:i}}}},t.issuePath=t.issuePath||"/rest/api/2/issue",t.defaultProxy=t.defaultProxy||"/jira-form-proxy.php?url=",t.postItem=function(e,s,r){return i.post((r||t.defaultProxy)+(s||t.defaultServer)+t.issuePath,e)},t.submitRequest=function(i,r){r.onSubmit&&r.onSubmit();var n=e.isString(r.summary)?r.summary:r.summary(i),u=e.isString(r.issueType)?r.issueType:r.issueType(i),o=e.isString(r.projectKey)?r.projectKey:r.projectKey(i),a=t.createIssue(n,u,o);return e.forEach(r.commonFields,function(e,s){a.fields[s]=t.generateField(e,i)}),e.isDefined(r.issueTypes)&&e.forEach(r.issueTypes[a.fields.issuetype.name],function(e,s){a.fields[s]=t.generateField(e,i)}),a.fields[r.inquiryDumpField]=s("json")(i),t.postItem(s("json")(a),r.server,r.proxyUrl).then(t.checkSuccessValidity)},t.checkSuccessValidity=function(t){var i=t.data;if(!(e.isObject(i)&&e.isString(i.self)&&e.isString(i.key)&&e.isString(i.id)))throw"Got success, but response does not match expectation.";return t},t}],this.setJIRAIssueCreationPath=function(e){t.issuePath=e},this.setServer=function(e){t.defaultServer=e},this.setProxy=function(e){t.defaultProxy=e}})}(window.angular);