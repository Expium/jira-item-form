angular.module("templates",[]).run(["$templateCache",function(e){e.put("form.html",'<span ng-show="inquiryController.showFailureMessage">\n  <h2>Something went wrong. If you continue to see this message, please contact us at {{inquiryController.failureContact}}</h2></span>\n<div ng-show="!inquiryController.showFailureMessage" class="well bs-component">\n  <form id="ss-form" name="ssForm" ng-submit="inquiryController.submit()" novalidate="novalidate" class="form-horizontal">\n    <fieldset>\n      <legend>{{inquiryController.config.title}}</legend>\n      <div ng-repeat="input in inquiryController.config.formFields" ng-switch="input.type" class="form-group"><span ng-switch-when="checkbox"><span class="col-sm-4 left-checkbox">\n            <input type="checkbox" ng-true-value="\'Yes\'" ng-false-value="\'No\'" name="{{input.inquiryField}}" ng-model="inquiryController.inquiry[input.inquiryField]" ng-required="input.required"/></span>\n          <label for="{{input.inquiryField}}" class="col-sm-8"></label>{{input.name}}</span><span ng-switch-when="prelabel">\n          <div class="col-sm-4"></div>\n          <div class="col-sm-8">{{input.name}}</div></span><span ng-switch-when="freeformText">\n          <label class="col-sm-4 control-label">{{input.name}}<span ng-if="input.required" class="required">*</span><span ng-if="::!input.hideColon">:</span></label>\n          <div class="col-sm-8">\n            <textarea name="{{input.inquiryField}}" ng-model="inquiryController.inquiry[input.inquiryField]" ng-required="input.required" class="form-control big-text-box"></textarea>\n          </div></span><span ng-switch-default="ng-switch-default">\n          <label for="{{input.inquiryField}}" class="col-sm-4 control-label">{{input.name}}<span ng-if="input.required" class="required">*</span><span ng-if="::!input.hideColon">:</span></label>\n          <div class="col-sm-8"><span ng-switch="input.type"><span ng-switch-when="label"></span><span ng-switch-when="select">\n                <select name="{{input.inquiryField}}" ng-model="inquiryController.inquiry[input.inquiryField]" class="form-control">\n                  <option ng-repeat="value in input.options" value="{{value}}" ng-bind="value"></option>\n                </select></span><span ng-switch-when="text">\n                <input type="{{input.type}}" placeholder="{{input.placeholder}}" name="{{input.inquiryField}}" ng-model="inquiryController.inquiry[input.inquiryField]" ng-required="input.required" maxlength="{{input.maxlength}}" class="form-control"/>\n                <div ng-messages="ssForm[input.inquiryField].$error" role="alert" class="text-warning">\n                  <div ng-message="required" ng-if="ssForm[input.inquiryField].$touched">{{input.name}} is required</div>\n                  <div ng-message="minlength">Email format appears incorrect, please check</div>\n                </div></span><span ng-switch-when="email">\n                <input type="email" name="{{input.inquiryField}}" ng-model="inquiryController.inquiry[input.inquiryField]" ng-required="input.required" maxlength="{{input.maxlength}}" class="form-control"/>\n                <div ng-messages="ssForm[input.inquiryField].$error" role="alert" class="text-warning">\n                  <div ng-message="required" ng-if="ssForm[input.inquiryField].$touched">{{input.name}} is required</div>\n                  <div ng-message="minlength">{{input.name}} is too short</div>\n                  <div ng-message="email">Email format appears incorrect, please check</div>\n                </div></span><span ng-switch-when="number">\n                <input type="number" name="{{input.inquiryField}}" ng-model="inquiryController.inquiry[input.inquiryField]" ng-required="input.required" maxlength="{{input.maxlength}}" class="form-control"/>\n                <div ng-messages="ssForm[input.inquiryField].$error" role="alert" class="text-warning">\n                  <div ng-message="required" ng-if="ssForm[input.inquiryField].$touched">{{input.name}} is required</div>\n                </div></span><span ng-switch-when="tel">\n                <input type="tel" name="{{input.inquiryField}}" ng-model="inquiryController.inquiry[input.inquiryField]" ng-required="input.required" class="form-control"/>\n                <div ng-messages="ssForm[input.inquiryField].$error" role="alert" class="text-warning">\n                  <div ng-message="required" ng-if="ssForm[input.inquiryField].$touched">{{input.name}} is required</div>\n                </div></span><span ng-switch-default="ng-switch-default"><span>{{input.name}} {{input.type}}</span></span></span></div></span></div><span ng-bind="inquiryController.message.success" class="text-success"></span><span ng-show="inquiryController.message.error" ng-bind="inquiryController.message.error + &quot; If you continue to see this error, contact us at &quot; + inquiryController.failureContact" role="alert" class="text-danger"></span>\n      <div class="form-group">\n        <div class="col-sm-8 col-sm-push-4">\n          <input type="hidden" name="draftResponse" value="[]                    "/>\n          <input type="hidden" name="pageHistory" value="0"/><br/>\n          <input id="ss-submit" type="submit" name="submit" value="{{inquiryController.submitting ? &quot;Submitting&quot; : &quot;Submit&quot;}}" ng-disabled="ssForm.$invalid || inquiryController.submitting" class="btn btn-primary"/>\n        </div>\n      </div><span class="col-sm-8 col-sm-offset-4"><span class="required">*</span>Indicates a required field</span>\n    </fieldset>\n  </form>\n</div>')}]),function(e,n,i){"use strict";e.module("jiraCreate").provider("JIRA",function(){var n={};this.$get=["$http","$filter","$q",function(i,r,t){return n.encloseInObject=function(e){return{value:e}},n.generateField=function(e,i){if(e.value)return e.value;if(i[e.inquiryField]){var r=e.map?e.map[i[e.inquiryField]]:i[e.inquiryField];return r=e.filter?e.filter(r):r,e.encloseInObject?n.encloseInObject(r):r}},n.createIssue=function(e,n,i){return{fields:{summary:e,issuetype:{name:n},project:{key:i}}}},n.issuePath=n.issuePath||"/rest/api/2/issue",n.defaultProxy=n.defaultProxy||"/jira-form-proxy.php?url=",n.postItem=function(e,r,t){return i.post((t||n.defaultProxy)+(r||n.defaultServer)+n.issuePath,e)},n.submitRequest=function(i,t){t.onSubmit&&t.onSubmit();var s=e.isString(t.summary)?t.summary:t.summary(i),o=e.isString(t.issueType)?t.issueType:t.issueType(i),u=e.isString(t.projectKey)?t.projectKey:t.projectKey(i),a=n.createIssue(s,o,u);return e.forEach(t.commonFields,function(e,r){a.fields[r]=n.generateField(e,i)}),e.isDefined(t.issueTypes)&&e.forEach(t.issueTypes[a.fields.issuetype.name],function(e,r){a.fields[r]=n.generateField(e,i)}),a.fields[t.inquiryDumpField]=r("json")(i),n.postItem(r("json")(a),t.server,t.proxyUrl)},n}],this.setJIRAIssueCreationPath=function(e){n.issuePath=e},this.setServer=function(e){n.defaultServer=e},this.setProxy=function(e){n.defaultProxy=e}}),e.module("jiraForm",["ngMessages","templates","jiraCreate"]).controller("InquiryController",["JIRA","$scope","validateConfig",function(n,i,r){function t(e){void 0!=e.status?s.message.error=0==e.status?"The server couldn't be reached":"Failed to access server with return status: "+e.statusText:s.message.error=e}var s=this;s.config=e.isString(i.config)?window[i.config]:i.config;var o={};return s.inquiry=e.copy(o),e.forEach(s.config.formFields,function(e){s.inquiry[e.inquiryField]=e["default"]}),s.message={},s.failureContact=s.config.errorContact,r(s.config)?(e.forEach(s.config.formFields,function(e){e["default"]&&(s.inquiry[e.inquiryField]=e["default"])}),void(s.submit=function(){s.message.success=void 0,s.message.error=void 0,s.submitting=!0,n.submitRequest(s.inquiry,s.config).then(function(n){var i=n.data;if(!(e.isObject(i)&&e.isString(i.self)&&e.isString(i.key)&&e.isString(i.id)))throw"Got success, but response does not match expectation."}).then(function(){s.message.success="Request has been submitted successfully",s.inquiry=e.copy(o),i.ssForm.$setPristine(),i.ssForm.$setUntouched()})["catch"](t)["finally"](function(){s.submitting=!1})})):void(s.showFailureMessage=!0)}]).directive("inquiryForm",function(){return{restrict:"E",templateUrl:"form.html",controller:"InquiryController as inquiryController",scope:{config:"="}}}).factory("validateConfig",function(){function n(e){console.warn(e)}return function(i){if(!e.isDefined(i))return n("configuration is undefined"),!1;if(!e.isString(i.proxyUrl))return n("proxyUrl is undefined"),!1;if(!e.isString(i.server))return n("No server provided"),!1;if(!e.isString(i.inquiryDumpField))return n("No field provided to dump input to"),!1;if(!e.isArray(i.formFields)||0==i.formFields.length)return n("No form fields provided"),!1;var r=!0;return e.forEach(i.formFields,function(i,t){i.name&&i.type&&("select"!=i.type||e.isArray(i.options))||(n("Invalid field "+t),r=!1)}),r?i.issueTypes||e.isString(i.issueType)?e.isString(i.issueType)||e.isFunction(i.issueType)?e.isString(i.projectKey)?e.isString(i.summary)||e.isFunction(i.summary)?!0:(n("No summary field string or function defined"),!1):(n("No project key defined"),!1):(n("No issue type function or string defined"),!1):(n("No issue types defined"),!1):!1}});var r=i.querySelectorAll("[ng-app]");0==r.length&&e.element(i).ready(function(){e.forEach(i.getElementsByTagName("inquiry-form"),function(n){e.bootstrap(n,["jiraForm"])})})}(window.angular,window.jiraConfig,window.document);